<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>도쿄 3박 4일 인터랙티브 여행 플래너</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral -->
    <!-- Application Structure Plan: A tab-based SPA with an 'Overview' dashboard and daily views. The daily view is now a two-column layout on wider screens: the main timeline on the left, and a new 'Checklist & Tips' panel on the right. This increases information density and adds utility (task tracking) without overwhelming the user. Cards are still expandable for deep details. -->
    <!-- Visualization & Content Choices: Overview - Charts retained for a quick summary. Daily Itinerary - Interactive cards with richer content. New 'Checklist' feature (HTML/JS) with checkboxes for interactivity and progress tracking. This directly addresses the feedback for "more information" by making key tasks and tips permanently visible on each day's view. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        :root {
            --base-font-size: 16px;
        }
        html {
            font-size: var(--base-font-size);
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .nav-button {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }
        .nav-button.active {
            color: #D97706;
            border-bottom-color: #D97706;
        }
        .card {
            background-color: #FFFFFF;
            border-left: 5px solid #FBBF24;
            transition: all 0.3s ease;
        }
        .card-header {
            cursor: pointer;
        }
        .card-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
        }
        .card-content.open {
            max-height: 2500px; /* Increased max-height for more content */
            transition: max-height 1s ease-in, padding 0.5s ease-in;
        }
        .heat-tip {
            background-color: #EFF6FF;
            border-left-color: #3B82F6;
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 280px;
            width: 100%;
            max-width: 400px;
        }
        .checklist-item input[type="checkbox"]:checked + input[type="text"] {
            text-decoration: line-through;
            color: #9CA3AF;
        }
        .checklist-text-input {
            background-color: transparent;
            border: none;
            outline: none;
            width: 100%;
        }
        .checklist-text-input:focus {
            background-color: #FFFBEB;
            border-bottom: 1px solid #FBBF24;
        }
        .shop-detail {
            border-top: 1px solid #F3F4F6;
            padding-top: 0.75rem;
            margin-top: 0.75rem;
        }
        .shop-detail:first-child {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
        }
        .map-link, .copy-button {
            display: inline-block;
            margin-left: 0.5rem;
            text-decoration: none;
            font-size: 1.1rem;
            transition: transform 0.2s ease, color 0.2s ease;
        }
        .map-link:hover, .copy-button:hover {
            transform: scale(1.2);
        }
        .copy-button {
            cursor: pointer;
        }
        .copy-button.copied {
            color: #10B981; /* Green-500 */
        }
        .memo-textarea {
            width: 100%;
            border-radius: 0.5rem;
            border: 1px solid #D1D5DB;
            padding: 0.5rem;
            font-size: 0.875rem;
            margin-top: 0.75rem;
            resize: vertical;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 320px;
                max-width: 500px;
            }
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto max-w-6xl p-4 sm:p-6">
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-amber-700">도쿄 3박 4일 '쇼핑 & 맛집' 최종 심화 코스</h1>
            <p class="mt-2 text-base md:text-lg text-gray-600">7월의 더위를 피하는 쾌적한 여행 플래너 (2025년 기준 정보)</p>
        </header>

        <nav class="flex justify-center border-b-2 border-gray-200 mb-2">
            <button data-day="0" class="nav-button active text-sm sm:text-base font-bold py-3 px-2 sm:px-4">✈️ 개요</button>
            <button data-day="1" class="nav-button text-sm sm:text-base font-bold py-3 px-2 sm:px-4">🗓️ 1일차</button>
            <button data-day="2" class="nav-button text-sm sm:text-base font-bold py-3 px-2 sm:px-4">🗓️ 2일차</button>
            <button data-day="3" class="nav-button text-sm sm:text-base font-bold py-3 px-2 sm:px-4">🗓️ 3일차</button>
            <button data-day="4" class="nav-button text-sm sm:text-base font-bold py-3 px-2 sm:px-4">🗓️ 4일차</button>
        </nav>
        
        <div id="font-controller" class="flex justify-center items-center gap-2 mb-6 text-sm">
            <span>글자 크기:</span>
            <button id="decrease-font" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-2 rounded-full">-</button>
            <button id="reset-font" class="bg-gray-200 hover:bg-gray-300 text-gray-800 py-1 px-2 rounded">초기화</button>
            <button id="increase-font" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-2 rounded-full">+</button>
        </div>

        <main id="content-area">
        </main>
    </div>

    <script>
        let tripData = {
            0: {
                title: "여행 개요 및 준비",
                sections: [
                    {
                        title: "여행 기본 정보",
                        icon: "✈️",
                        items: [
                            { name: "항공편", content: [{ detail: "<b>출국:</b> 7/28(월) 07:40 GMP → 09:50 HND<br><b>귀국:</b> 7/31(목) 20:05 HND → GMP" }] },
                            { name: "숙소", content: [{ detail: "<b>1일차:</b> Onyado Nono Asakusa Bettei (아사쿠사)<br><b>2-3일차:</b> Nohga Hotel Akihabara Tokyo (아키하바라)" }] },
                        ]
                    },
                    {
                        title: "여행 준비 & 예약 팁",
                        icon: "💡",
                        items: [
                            { name: "한국에서 준비", content: [{ detail: "eSIM/유심, 여행자 보험, 110V 변환 어댑터, 각종 티켓 예매" }] },
                            { name: "식당 예약 팁", content: [{ detail: "온라인 예약(타베로그 등), 호텔 컨시어지, 구글맵 예약 기능을 적극 활용하세요." }] },
                        ]
                    },
                ]
            },
            1: {
                title: "아사쿠사 집중 탐방",
                theme: "전통과 현대가 공존하는 아사쿠사의 낮과 밤",
                route_highlight: "하루 종일 아사쿠사 지역에 머물며, 센소지를 중심으로 주변 맛집과 거리를 탐방하고 저녁에는 스카이트리 또는 호피도리로 이동하는 효율적인 동선입니다.",
                checklist: [
                    { text: "사료 츠보시타에서 말차 디저트 먹기", done: false },
                    { text: "키비단고 아즈마에서 당고 맛보기", done: false },
                    { text: "아사쿠사 카게츠도 멜론빵 구매", done: false },
                    { text: "밤의 미션: 쟈지 우유 푸딩 찾기", done: false }
                ],
                sections: [
                    {
                        time: "오전 10:00 ~ 11:30",
                        title: "도착 및 준비",
                        items: [{ name: "호텔 짐 보관", icon: "🛄", content: [{ detail: "하네다 공항 도착 후 게이큐선으로 '아사쿠사역'으로 이동, Onyado Nono Asakusa Bettei 호텔에 짐 맡기기" }] }]
                    },
                    {
                        time: "오전 11:30 ~ 오후 5:00",
                        title: "아사쿠사 낮 코스: 센소지 주변 탐방",
                        items: [
                            { name: "점심 식사 (선택)", icon: "🍜", content: [
                                { name: { kor: "텐동 텐야", jpn: "てんや", eng: "Tendon Tenya" }, description: "압도적인 가성비의 텐동 체인점", signatureMenu: "기본 텐동", menuDescription: "밥 위에 각종 튀김을 올린 덮밥", avgCostPerPerson: "약 ¥900 / ₩8,100 (기본 텐동 + 미소시루)", tip: "웨이팅 거의 없음, 빠르고 저렴하게 해결" },
                                { name: { kor: "다이코쿠야 텐푸라", jpn: "大黒家天麩羅", eng: "Daikokuya Tempura" }, description: "참기름으로 튀긴 촉촉한 전통 텐동", signatureMenu: "텐동", menuDescription: "진한 간장 소스에 푹 담근 튀김 덮밥", avgCostPerPerson: "약 ¥2,200 / ₩19,800 (텐동 1개 기준)", tip: "바삭함보다 진한 소스 맛을 즐기는 곳. 식사 시간 웨이팅 김." },
                                { name: { kor: "소메타로", jpn: "染太郎", eng: "Sometaro" }, description: "직접 만들어 먹는 체험형 오코노미야키", signatureMenu: "오코노미야키", menuDescription: "재료를 섞어 철판에 부쳐먹는 일본식 전", avgCostPerPerson: "약 ¥1,600 / ₩14,400 (오코노미야키 1개 + 음료)", tip: "옛 일본 가옥의 정취를 느낄 수 있음." },
                                { name: { kor: "아사쿠사 이마한", jpn: "浅草今半", eng: "Asakusa Imahan" }, description: "100년 역사의 스키야키 명가", signatureMenu: "스키야키 런치 코스", menuDescription: "소고기와 채소를 끓여 날달걀에 찍어 먹는 전골", avgCostPerPerson: "점심 약 ¥5,500 / ₩49,500 (런치 코스 기준)", tip: "예약 필수. 저녁보다 합리적인 점심 추천." },
                            ]},
                            { name: "전통 디저트 & 간식 투어", icon: "🍡", content: [
                                { name: { kor: "키비단고 아즈마", jpn: "きびだんご あづま", eng: "Kibidango Azuma" }, description: "따끈하고 부드러운 수수 경단", signatureMenu: "키비단고", menuDescription: "콩고물을 묻힌 작은 수수 경단 꼬치", avgCostPerPerson: "약 ¥400 / ₩3,600 (1인분 기준)", tip: "나카미세도리 초입에 위치. 회전율이 빠름." },
                                { name: { kor: "아사쿠사 카게츠도", jpn: "浅草花月堂", eng: "Asakusa Kagetsudo" }, description: "얼굴만 한 크기의 거대 멜론빵", signatureMenu: "멜론빵", menuDescription: "겉은 바삭, 속은 촉촉한 일본 대표 간식 빵", avgCostPerPerson: "약 ¥300 / ₩2,700 (빵 1개 기준)", tip: "센소지 본당 근처에 위치." },
                                { name: { kor: "사료 츠보시타", jpn: "茶寮 つぼ市製茶本舗", eng: "Saryo Tsuboichi" }, description: "고급스러운 분위기의 전문 말차 카페", signatureMenu: "말차 파르페", menuDescription: "말차 아이스크림, 팥, 떡 등을 올린 디저트", avgCostPerPerson: "약 ¥1,600 / ₩14,400 (파르페 1개 기준)", tip: "덴보인도리 근처. 잠시 쉬어가기 좋은 곳." },
                                { name: { kor: "후르츠 팔러 고토", jpn: "フルーツパーラーゴトー", eng: "Fruit Parlor Goto" }, description: "제철 과일 듬뿍 파르페 맛집", signatureMenu: "계절 과일 파르페", menuDescription: "신선한 제철 과일로 만든 화려한 파르페", avgCostPerPerson: "약 ¥2,800 / ₩25,200 (파르페 1개 기준)", tip: "1시간 이상 웨이팅은 기본. 시간에 여유 있을 때 방문." },
                            ]},
                             { name: "추가 추천 (쇼핑 & 구경)", icon: "✨", content: [
                                { name: { kor: "무인양품 (아사쿠사 EKIMISE점)", jpn: "無印良品 浅草EKIMISE", eng: "MUJI Asakusa EKIMISE" }, description: "아사쿠사역과 연결된 쇼핑몰 내 위치", signatureMenu: "의류, 잡화, 식품", avgCostPerPerson: "쇼핑 비용", tip: "동선이 편리하고, 여행 중 필요한 물품을 구매하기 좋음." },
                                { name: { kor: "갓파바시 도구 거리", jpn: "かっぱ橋道具街", eng: "Kappabashi Kitchen Town" }, description: "일본 최대의 주방용품 전문 상점가", signatureMenu: "그릇, 칼, 음식 모형 등", avgCostPerPerson: "구경은 무료", tip: "요리에 관심 없어도 음식 모형 가게 등 볼거리가 많음." },
                            ]},
                            { name: "주변 산책 및 피서", icon: "🚶‍♂️", type: "heat-tip", content: [{ detail: "<b>산책:</b> 덴보인도리 (伝法院通り / Denboin-dori) → 스미다 공원 강변 산책<br><b>실내 피서:</b> 아사쿠사 문화 관광 센터 8층 무료 전망대, 신나카미세 상점가 (新仲見世商店街 / Shin-Nakamise) 구경<br><b>지하 쇼핑:</b> 아사쿠사역과 연결된 일본에서 가장 오래된 지하상가인 아사쿠사 지하상가 (浅草地下街 / Asakusa Chikagai)에서 레트로한 분위기를 느껴보세요." }] },
                        ]
                    },
                    {
                        time: "오후 5:00 이후",
                        title: "아사쿠사 밤 코스: 야경과 저녁",
                        items: [
                            { name: "호텔 체크인 및 휴식", icon: "♨️", content: [{ detail: "호텔 체크인 후 온천 시설 즐기기" }] },
                            { name: "저녁 & 야경 (선택)", icon: "🌃", content: [
                                { name: { kor: "A코스: 스카이트리", jpn: "東京スカイツリー", eng: "Tokyo Skytree" }, description: "아사쿠사에서 도보 또는 지하철로 이동. 야경, 쇼핑, 식사를 한 번에 해결", signatureMenu: "소라마치 내 다양한 레스토랑", avgCostPerPerson: "식사 약 ¥3,000~ / ₩27,000원~", tip: "스카이트리 전망대는 온라인 사전 예매 강력 추천." },
                                { name: { kor: "B코스: 호피도리", jpn: "ホッピー通り", eng: "Hoppy Dori" }, description: "센소지 서쪽에 위치한 활기찬 선술집 거리", signatureMenu: "소 힘줄 조림(규스지니코미)", menuDescription: "소 힘줄을 부드럽게 끓여낸 일본식 안주", avgCostPerPerson: "약 ¥3,000 / ₩27,000 (안주 2개 + 주류)", tip: "저녁 시간엔 매우 붐비지만 빈자리를 찾아 들어가는 재미가 있음." },
                                { name: { kor: "C코스: 몬자야키", jpn: "もんじゃ もへじ", eng: "Monja Moheji" }, description: "아사쿠사 내에 위치한 도쿄 명물 몬자야키 전문점", signatureMenu: "명란 몬자야키", menuDescription: "묽은 반죽에 재료를 섞어 철판에 지져 먹는 음식", avgCostPerPerson: "약 ¥2,500 / ₩22,500 (몬자야키 + 음료)", tip: "직원이 직접 만들어주는 경우가 많아 편리함." },
                            ]},
                             { name: "저녁 산책 코스", icon: "🚶‍♂️", content: [{ detail: "<b>A코스 선택 시:</b> 스카이트리 아래 소라마치 주변 산책<br><b>B코스 선택 시:</b> 조명이 켜진 센소지 경내를 둘러본 후 호피도리로 이동<br><b>C코스 선택 시:</b> 스미다 강변을 따라 걸으며 라이트업된 아사히 맥주 빌딩과 스카이트리 야경 감상" }] },
                        ]
                    }
                ]
            },
            2: {
                title: "아키하바라 & 간다 탐방",
                theme: "서브컬처 성지 순례와 전통 신사 방문",
                route_highlight: "아사쿠사에서 아키하바라로 이동 후, 하루 종일 아키하바라와 인접한 간다 지역에 집중하는 동선입니다. 주요 쇼핑몰과 명소가 모두 도보 거리에 있습니다.",
                checklist: [
                    { text: "간다 묘진 'IT 부적' 구경하기", done: false },
                    { text: "Yodobashi-Akiba에서 전자제품 쇼핑", done: false },
                    { text: "라디오회관에서 피규어 구경", done: false },
                    { text: "애니메이트 방문하기", done: false }
                ],
                sections: [
                    {
                        time: "오전",
                        title: "아키하바라 이동 및 오전 코스",
                        items: [
                            { name: "호텔 이동 및 짐 보관", icon: "🛄", content: [{ detail: "아사쿠사 체크아웃 → 긴자선으로 '스에히로초역' 이동 → Nohga Hotel Akihabara Tokyo에 짐 맡기기" }] },
                            { name: "아침 식사 (선택)", icon: "☕", content: [
                                { name: { kor: "펠리칸 카페", jpn: "ペリカンカフェ", eng: "Pelican Cafe" }, description: "80년 전통 식빵으로 만든 토스트", signatureMenu: "숯불 토스트", menuDescription: "숯불에 구워 겉바속촉 식감이 특징인 토스트", avgCostPerPerson: "약 ¥1,300 / ₩11,700 (토스트 + 커피)", tip: "아사쿠사 출발 전 방문. 오픈 시간에도 줄이 있을 정도로 인기." },
                                { name: { kor: "블루 보틀 커피", jpn: "ブルーボトルコーヒー 神田万世橋", eng: "Blue Bottle Coffee Kanda" }, description: "붉은 벽돌 아치가 멋진 감성 카페", signatureMenu: "드립 커피, 와플", avgCostPerPerson: "약 ¥1,300 / ₩11,700 (커피 + 디저트)", tip: "아키하바라 도착 후 방문. 분위기를 즐기기 좋은 곳." },
                                { name: { kor: "스키야/요시노야", jpn: "すき家/吉野家", eng: "Sukiya/Yoshinoya" }, description: "초고속 가성비 아침 정식", signatureMenu: "규동, 생선구이 정식", avgCostPerPerson: "약 ¥700 / ₩6,300 (아침 정식 기준)", tip: "웨이팅 없이 바로 식사 가능." },
                            ]},
                            { name: { kor: "간다 묘진", jpn: "神田明神", eng: "Kanda Myojin Shrine" }, icon: "⛩️", content: [{ detail: "아키하바라 탐방 전, 먼저 신사에 들러 IT 기기를 지켜준다는 독특한 'IT 부적'과 애니메이션 콜라보 에마를 구경합니다." }] },
                            { name: "오전 산책 코스", icon: "🚶‍♂️", content: [{ detail: "호텔에서 간다 묘진까지 걸으며 주변의 작은 상점과 오피스 거리 풍경 구경하기" }] },
                        ]
                    },
                    {
                        time: "점심 식사 후 오후",
                        title: "아키하바라 오후 코스: 쇼핑 집중",
                        items: [
                            { name: "점심 식사 (선택)", icon: "🍛", content: [
                                { name: { kor: "규카츠 이치니산", jpn: "牛カツ壱弐参", eng: "Gyukatsu Ichi Ni San" }, description: "개인 화로에 직접 구워 먹는 규카츠", signatureMenu: "규카츠 정식", menuDescription: "겉만 살짝 튀긴 소고기를 돌판에 구워먹는 커틀릿", avgCostPerPerson: "약 ¥1,800 / ₩16,200 (기본 정식 기준)", tip: "식사 시간엔 항상 긴 줄. 오픈 직후나 늦은 오후 방문 추천." },
                                { name: { kor: "큐슈 장가라 라멘", jpn: "九州じゃんがららあめん", eng: "Kyushu Jangara Ramen" }, description: "진한 돈코츠 라멘 전문점", signatureMenu: "돈코츠 라멘", menuDescription: "돼지뼈를 우려낸 뽀얀 국물의 라멘", avgCostPerPerson: "약 ¥1,200 / ₩10,800 (기본 라멘 + 토핑)", tip: "토핑을 자유롭게 추가 가능. 줄은 빨리 줄어드는 편." },
                                { name: { kor: "고고카레", jpn: "ゴーゴーカレー", eng: "Go! Go! Curry!" }, description: "볼륨 만점의 진한 카레라이스", signatureMenu: "로스카츠 카레", menuDescription: "돈카츠를 올린 진한 일본식 카레", avgCostPerPerson: "약 ¥1,100 / ₩9,900 (기본 카레 기준)", tip: "고릴라 간판이 인상적. 웨이팅 거의 없음." },
                            ]},
                             { name: "추가 추천 (쇼핑 & 구경)", icon: "✨", content: [
                                { name: { kor: "무인양품 (아키바 토림점)", jpn: "無印良品 アキバ・トリム", eng: "MUJI Akiba Tolim" }, description: "아키하바라역과 바로 연결된 쇼핑몰", signatureMenu: "의류, 잡화, 식품", avgCostPerPerson: "쇼핑 비용", tip: "역과 바로 연결되어 있어 접근성이 매우 좋음." },
                                { name: { kor: "슈퍼 포테이토", jpn: "スーパーポテト", eng: "Super Potato" }, description: "레트로 게임의 성지", signatureMenu: "고전 게임 팩, 게임기", avgCostPerPerson: "구경은 무료", tip: "5층 게임 코너에서 추억의 게임을 직접 해볼 수 있음." },
                                { name: { kor: "만다라케 콤플렉스", jpn: "まんだらけコンプレックス", eng: "Mandarake Complex" }, description: "8층 규모의 거대한 중고 서브컬처 샵", signatureMenu: "만화, 피규어, 게임 등", avgCostPerPerson: "구경은 무료", tip: "희귀한 아이템을 발견하는 재미가 쏠쏠함." },
                            ]},
                            { name: "오후 실내 산책 (피서)", icon: "🚶‍♂️", type: "heat-tip", content: [{ detail: "<b>추천 동선:</b> 요도바시 아키바 (ヨドバシAkiba) → 라디오회관 (ラジオ会館) → 애니메이트 (アニメイト) 순으로 대형 건물을 옮겨 다니며 쇼핑<br><b>지적인 피서:</b> 아키하바라에서 가까운 진보초 (神保町) 헌책방 거리까지 걸어가며 탐방" }] },
                        ]
                    },
                    {
                        time: "저녁",
                        title: "아키하바라의 밤",
                        items: [
                            { name: "호텔 체크인", icon: "🏨", content: [{ detail: "호텔 체크인 후 휴식" }] },
                            { name: "저녁 식사 (선택)", icon: "🏮", content: [
                                { name: { kor: "톤카츠 아오키", jpn: "とんかつ檍", eng: "Tonkatsu Aoki" }, description: "고급 돼지고기를 사용한 가성비 돈카츠", signatureMenu: "로스카츠 정식", menuDescription: "두툼한 등심 돈카츠 정식", avgCostPerPerson: "약 ¥2,500 / ₩22,500 (로스카츠 정식 기준)", tip: "소금에 찍어 먹는 것을 추천. 저녁 시간 웨이팅 가능성." },
                                { name: { kor: "나카우", jpn: "なか卯", eng: "Nakau" }, description: "촉촉한 오야코동이 맛있는 규동 체인", signatureMenu: "오야코동", menuDescription: "닭고기 계란 덮밥", avgCostPerPerson: "약 ¥800 / ₩7,200 (오야코동 1개 기준)", tip: "웨이팅 없이 바로 식사 가능." },
                                { name: { kor: "이세겐", jpn: "いせ源", eng: "Isegen" }, description: "문화재 건물에서 즐기는 아귀 전골", signatureMenu: "아귀 전골 코스", menuDescription: "아귀와 채소를 끓여 먹는 전골 요리", avgCostPerPerson: "저녁 약 ¥11,000 / ₩99,000 (코스 기준)", tip: "간다역 근처. 도쿄 유일의 아귀 요리 전문점. 예약 필수." },
                            ]},
                            { name: "저녁 산책 코스", icon: "🚶‍♂️", content: [{ detail: "네온사인이 화려한 아키하바라의 밤거리를 산책하거나, 조금 조용한 분위기를 원한다면 호텔 주변의 간다 강변을 따라 걷기" }] },
                        ]
                    }
                ]
            },
            3: {
                title: "긴자 → 도쿄역 → 마루노우치",
                theme: "세련된 쇼핑과 캐릭터, 그리고 화려한 야경",
                route_highlight: "긴자/유라쿠초 지역에서 쇼핑과 점심을 즐긴 후, 도보나 지하철로 가까운 도쿄역으로 이동합니다. 저녁에는 도쿄역 주변 또는 치요다구청에서 야경을 감상하는 코스입니다.",
                checklist: [
                    { text: "무인양품 긴자점 쇼핑하기", done: false },
                    { text: "아식스 긴자점에서 쇼핑하기", done: false },
                    { text: "치이카와 랜드 방문하기", done: false },
                    { text: "치요다구청 무료 야경 감상하기", done: false }
                ],
                sections: [
                    {
                        time: "오전",
                        title: "긴자 코스: 플래그십 스토어 탐방",
                        items: [
                            { name: { kor: "★메인 미션: 무인양품 긴자점", jpn: "無印良品 銀座", eng: "MUJI Ginza" }, icon: "🛍️", content: [{ detail: "JR 유라쿠초역에서 하차. 이번 여행의 핵심 코스! 세계 최대 규모의 무인양품에서 시간을 넉넉히 잡고 쇼핑, 식사, 휴식까지 모든 것을 즐겨보세요." }] },
                            { name: { kor: "★메인 미션: 아식스 긴자", jpn: "アシックスランウォークギンザ", eng: "ASICS RUNWALK GINZA" }, icon: "👟", content: [{ detail: "무인양품 근처에 위치. 3D 발 계측 서비스 등을 통해 내 발에 꼭 맞는 신발을 찾아보세요. 의류 및 액세서리도 다양합니다." }] },
                            { name: "오전 산책 코스 (긴자)", icon: "🚶‍♂️", content: [{ detail: "무인양품 쇼핑 후, 긴자의 중심 거리인 주오도리(中央通り)를 따라 아이쇼핑하며 걷기. 주말에는 '보행자 천국'으로 운영되어 차 없는 거리를 즐길 수 있습니다." }] },
                            { name: "점심 식사 (긴자/니혼바시)", icon: "🍜", content: [
                                { name: { kor: "긴자 카가리", jpn: "銀座 篝", eng: "Ginza Kagari" }, description: "미슐랭 가이드에 오른 닭백탕 라멘", signatureMenu: "토리파이탄 소바", menuDescription: "뽀얗고 진한 닭 육수 라멘", avgCostPerPerson: "약 ¥1,600 / ₩14,400 (라멘 1개 기준)", tip: "예약 불가, 1~2시간 웨이팅 각오. 크림수프 같은 진한 국물." },
                                { name: { kor: "긴자 스위스", jpn: "銀座スイス", eng: "Ginza Swiss" }, description: "'카츠카레'를 처음 만든 원조 가게", signatureMenu: "원조 카츠카레", menuDescription: "카레라이스 위에 돈카츠를 올린 요리", avgCostPerPerson: "약 ¥1,900 / ₩17,100 (카츠카레 1개 기준)", tip: "클래식한 경양식집 분위기." },
                                { name: { kor: "타이메이켄", jpn: "たいめいけん", eng: "Taimeiken" }, description: "80년 전통의 유명 오므라이스 맛집", signatureMenu: "탄포포 오므라이스", menuDescription: "칼로 가르면 펼쳐지는 반숙 오믈렛이 특징", avgCostPerPerson: "약 ¥2,800 / ₩25,200 (오므라이스 1개 기준)", tip: "니혼바시에 위치. 점심시간 줄이 김." },
                            ]},
                        ]
                    },
                    {
                        time: "오후",
                        title: "도쿄역 코스: 캐릭터 쇼핑 & 산책",
                        items: [
                            { name: { kor: "치이카와 랜드", jpn: "ちいかわらんど", eng: "Chiikawa Land" }, icon: "💖", content: [{ detail: "긴자에서 도쿄역으로 이동. '도쿄 캐릭터 스트리트' 방문. 방문 전 공식 SNS에서 정리권(번호표) 배부 여부 확인 필수!" }] },
                             { name: "추가 추천 (선택)", icon: "✨", content: [
                                { name: { kor: "이토야", jpn: "伊東屋", eng: "Itoya" }, description: "100년 역사의 대형 문구 전문점", signatureMenu: "만년필, 노트, 디자인 소품", avgCostPerPerson: "구경은 무료", tip: "문구에 관심이 있다면 꼭 들러봐야 할 곳. 건물 전체가 볼거리." },
                                { name: { kor: "긴자 웨스트", jpn: "銀座ウエスト", eng: "Ginza West" }, description: "클래식한 분위기의 노포 카페", signatureMenu: "리프 파이, 케이크", menuDescription: "고풍스러운 분위기에서 즐기는 커피와 디저트", avgCostPerPerson: "약 ¥1,500 / ₩13,500", tip: "쇼핑 중 잠시 쉬어가기 좋은 차분한 공간." },
                            ]},
                            { name: "오후 산책 코스 (도쿄역)", icon: "🚶‍♂️", type: "heat-tip", content: [{ detail: "<b>산책:</b> 도쿄역 마루노우치 광장에서 고풍스러운 역사를 감상하고, 황궁으로 이어지는 넓은 교코도리(行幸通り) 산책<br><b>실내 피서:</b> KITTE (キッテ) 옥상정원, 마루노우치 빌딩, 신마루노우치 빌딩 등에서 쇼핑 및 휴식<br><b>지하 쇼핑:</b> 도쿄역과 연결된 야에스 지하상가 (八重洲地下街) 탐방" }] },
                        ]
                    },
                    {
                        time: "저녁",
                        title: "야경 & 저녁 식사",
                        items: [
                            { name: { kor: "치요다구청 무료 야경", jpn: "千代田区役所", eng: "Chiyoda City Office" }, icon: "🌃", content: [{ detail: "도쿄역에서 지하철로 이동. 10층 전망 휴게실에서 고쿄와 마루노우치 빌딩 숲의 차분하고 고급스러운 야경을 무료로 감상할 수 있습니다." }] },
                            { name: "저녁 식사 (도쿄역/유라쿠초)", icon: "🍷", content: [
                                { name: { kor: "오레노 이탈리안", jpn: "俺のイタリアン", eng: "Ore no Italian" }, description: "고급 요리를 저렴하게 즐기는 인기 레스토랑", signatureMenu: "파스타, 피자", avgCostPerPerson: "약 ¥4,000 / ₩36,000 (요리 2개 + 주류)", tip: "서서 먹는 컨셉. 예약하거나 일찍 방문 추천." },
                                { name: { kor: "유라쿠초 가도 시타", jpn: "有楽町ガード下", eng: "Yurakucho Gado-shita" }, description: "퇴근길 직장인들의 찐 현지 맛집 거리", signatureMenu: "야키토리(닭꼬치)", menuDescription: "닭고기 숯불 꼬치구이", avgCostPerPerson: "약 ¥3,000 / ₩27,000 (꼬치 + 맥주)", tip: "연기 자욱한 좁은 가게에서 즐기는 일본 감성." },
                                { name: { kor: "버드랜드 긴자", jpn: "バードランド 銀座", eng: "Bird Land Ginza" }, description: "미슐랭 스타 야키토리 전문점", signatureMenu: "오마카세 코스", menuDescription: "주방장이 엄선한 닭꼬치 코스 요리", avgCostPerPerson: "저녁 약 ¥13,000 / ₩117,000 (코스 기준)", tip: "최소 몇 주 전 예약 필수." },
                            ]},
                            { name: "저녁 산책 코스 (야경)", icon: "🚶‍♂️", content: [{ detail: "저녁 식사 후, 일루미네이션이 아름다운 마루노우치 나카도리(丸の内仲通り)를 걷거나, 도쿄역 야경을 감상하며 산책하기" }] },
                        ]
                    }
                ]
            },
            4: {
                title: "우에노 & 야나카 산책 후 공항으로",
                theme: "활기찬 시장과 정겨운 골목, 그리고 마지막 만찬",
                route_highlight: "아키하바라에서 가까운 우에노로 이동하여 시장과 공원을 둘러본 후, 도보로 야나카 긴자까지 산책하는 여유로운 동선입니다. 하네다 공항 이동을 고려해 일정을 마무리합니다.",
                checklist: [
                    { text: "아메요코 시장에서 쇼핑하기", done: false },
                    { text: "야나카 긴자에서 멘치카츠 먹기", done: false },
                    { text: "우에노 공원 미술관/박물관 방문", done: false },
                    { text: "공항 면세점에서 선물 구매하기", done: false }
                ],
                sections: [
                    {
                        time: "오전",
                        title: "우에노 & 야나카 오전 코스",
                        items: [
                            { name: "호텔 체크아웃 및 이동", icon: "🛄", content: [{ detail: "호텔 체크아웃 후 짐 맡기고 우에노로 이동" }] },
                            { name: "오전 활동 (선택)", icon: "🛒", content: [{ detail: "<b>A. 아키하바라 마무리:</b> 못 산 물건 쇼핑<br><b>B. 우에노 시장 구경:</b> 아메요코 시장 (アメ横 / Ameya Yokocho)에서 드럭스토어 등 쇼핑<br><b>C. 야나카 긴자 산책:</b> '고양이 마을' 야나카 긴자 (谷中銀座 / Yanaka Ginza)에서 길거리 음식 즐기기" }] },
                             { name: "추가 추천 (쇼핑 & 구경)", icon: "✨", content: [
                                { name: { kor: "무인양품 (우에노 마루이점)", jpn: "無印良品 上野マルイ", eng: "MUJI Ueno Marui" }, description: "우에노역 바로 앞 백화점 내 위치", signatureMenu: "의류, 잡화, 식품", avgCostPerPerson: "쇼핑 비용", tip: "마지막 날 선물을 사거나 필요한 물품을 구매하기 좋음." },
                                { name: { kor: "야나카 시놋포야", jpn: "やなかしっぽや", eng: "Yanaka Shippoya" }, description: "고양이 꼬리 모양의 귀여운 도넛", signatureMenu: "고양이 꼬리 도넛", menuDescription: "다양한 맛의 스틱형 구운 도넛", avgCostPerPerson: "약 ¥500 / ₩4,500", tip: "야나카 긴자 산책의 필수 간식. 사진 찍기 좋음." },
                                { name: { kor: "야마시로야", jpn: "ヤマシロヤ", eng: "Yamashiroya" }, description: "우에노역 앞 대형 장난감 가게", signatureMenu: "캐릭터 상품, 장난감", avgCostPerPerson: "구경은 무료", tip: "아이와 함께라면 꼭 들러봐야 할 곳. 어른도 즐겁다." },
                            ]},
                            { name: "오전 산책 코스 (우에노/야나카)", icon: "🚶‍♂️", type: "heat-tip", content: [{ detail: "<b>시장 산책:</b> 활기 넘치는 아메요코 시장 (アメ横) 구경<br><b>공원 산책:</b> 우에노 공원 (上野公園)의 녹음을 즐기며 시노바즈 연못 주변 걷기<br><b>골목 산책:</b> 우에노 공원을 가로질러 정겨운 야나카 긴자 (谷中銀座) 골목까지 걷기" }] },
                        ]
                    },
                    {
                        time: "점심 식사",
                        title: "우에노에서의 마지막 만찬",
                        items: [
                            { name: "점심 식사 추천", icon: "🍣", content: [
                                { name: { kor: "야마베 오카치마치점", jpn: "とんかつ山家 御徒町店", eng: "Tonkatsu Yamabe" }, description: "1000엔 이하 최고의 가성비 돈카츠", signatureMenu: "로스카츠 정식", menuDescription: "두툼한 등심 돈카츠와 밥, 국이 나오는 정식", avgCostPerPerson: "약 ¥950 / ₩8,550 (로스카츠 정식 기준)", tip: "식사 시간에는 항상 긴 줄이 있음." },
                                { name: { kor: "미우라미사키코", jpn: "三浦三崎港", eng: "Miuramisakiko" }, description: "큼직한 네타가 특징인 인기 회전초밥", signatureMenu: "참치, 제철 생선", menuDescription: "접시를 가득 채우는 신선한 회전초밥", avgCostPerPerson: "약 ¥2,800 / ₩25,200 (5~6접시 기준)", tip: "식사 시간 웨이팅 가능성." },
                                { name: { kor: "우나토토", jpn: "宇奈とと", eng: "Unatoto" }, description: "단돈 550엔부터 시작하는 파격적 장어덮밥", signatureMenu: "우나동", menuDescription: "달콤짭짤한 소스를 바른 장어구이 덮밥", avgCostPerPerson: "약 ¥900 / ₩8,100 (기본 우나동 기준)", tip: "저렴하게 장어 맛보고 싶을 때 최적." },
                                { name: { kor: "미나토야", jpn: "みなとや", eng: "Minatoya" }, description: "시장 한복판의 신선한 해산물 덮밥", signatureMenu: "카이센동", menuDescription: "밥 위에 신선한 회를 올린 덮밥", avgCostPerPerson: "약 ¥800 / ₩7,200 (카이센동 1개 기준)", tip: "서서 먹는 곳이라 회전율 빠름." },
                            ]},
                             { name: "점심 식사 후 산책", icon: "🚶‍♂️", content: [{ detail: "식사 후 우에노 공원 내 미술관이나 박물관으로 이동하며 짧게 산책하거나, 아메요코 시장에서 소화시킬 겸 마지막 쇼핑 즐기기" }] },
                        ]
                    },
                    {
                        time: "오후 3:30 ~",
                        title: "공항으로 이동 및 출국",
                        items: [
                            { name: "출국 준비", icon: "🎁", content: [{ detail: "아키하바라 호텔에서 짐 찾고 공항으로 이동. 체크인 후 면세점에서 '도쿄 밀크 치즈 팩토리', '뉴욕 퍼펙트 치즈' 등 선물 구매" }] },
                        ]
                    }
                ]
            }
        };

        const contentArea = document.getElementById('content-area');
        const navButtons = document.querySelectorAll('.nav-button');
        let themeChart = null;
        let budgetChart = null;

        function createActionLinks(nameObj) {
            if (!nameObj || !nameObj.jpn) return '';
            const query = encodeURIComponent(nameObj.jpn);
            const mapLink = `<a href="https://www.google.com/maps/search/?api=1&query=${query}" target="_blank" rel="noopener noreferrer" class="map-link" title="구글 지도에서 보기">📍</a>`;
            const copyButton = `<span class="copy-button" data-copy-text="${nameObj.jpn}" title="이름 복사">📋</span>`;
            return mapLink + copyButton;
        }

        function renderOverview() {
            const dayData = tripData[0];
            let html = `<h2 class="text-2xl font-bold mb-4 text-amber-800">${dayData.title}</h2>`;

            dayData.sections.forEach(section => {
                html += `
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold mb-3 flex items-center"><span class="mr-2">${section.icon}</span> ${section.title}</h3>
                        <div class="space-y-3">
                `;
                section.items.forEach(item => {
                    html += `
                        <div class="card p-4 rounded-lg shadow-sm border-l-amber-400">
                            <p class="font-semibold text-gray-800">${item.name}</p>
                            <div class="text-gray-600 text-sm mt-1">${item.content[0].detail}</div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            });
            
            html += `
                <div class="grid md:grid-cols-2 gap-8 mt-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-3 text-center">📊 일자별 활동 테마</h3>
                        <div class="chart-container bg-white p-4 rounded-lg shadow-md"><canvas id="themeChart"></canvas></div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-3 text-center">💰 식사 예산 분배 (컨셉)</h3>
                        <div class="chart-container bg-white p-4 rounded-lg shadow-md"><canvas id="budgetChart"></canvas></div>
                    </div>
                </div>
            `;

            contentArea.innerHTML = html;
            renderCharts();
        }
        
        function renderDay(day) {
            if (day === 0) {
                renderOverview();
                return;
            }

            const dayData = tripData[day];
            let html = `<div class="grid lg:grid-cols-3 gap-8">`;
            
            html += `<div class="lg:col-span-2">`;
            html += `<h2 class="text-2xl font-bold mb-1 text-amber-800">${day}일차: ${dayData.title}</h2>`;
            html += `<p class="text-md text-gray-500 mb-6">${dayData.theme}</p>`;
            html += `<div class="space-y-6">`;

            dayData.sections.forEach((section, sectionIndex) => {
                html += `
                    <div>
                        <div class="flex items-center mb-3">
                            <span class="bg-amber-500 text-white text-sm font-bold px-3 py-1 rounded-full">${section.time}</span>
                            <h3 class="text-xl font-semibold ml-3">${section.title}</h3>
                        </div>
                        <div class="space-y-3 pl-4 border-l-2 border-gray-200 ml-5">
                `;
                section.items.forEach((item, itemIndex) => {
                    const isHeatTip = item.type === 'heat-tip';
                    const itemName = typeof item.name === 'object' ? item.name.kor : item.name;
                    const actionLinks = createActionLinks(item.name);
                    const itemSubName = typeof item.name === 'object' ? `<p class="text-xs text-gray-400 mt-1">${item.name.jpn} / ${item.name.eng}</p>` : '';

                    let contentHtml = '';
                    item.content.forEach((detailItem, detailIndex) => {
                        if (detailItem.name) {
                            const detailActionLinks = createActionLinks(detailItem.name);
                            const dataPath = `${day}-${sectionIndex}-${itemIndex}-${detailIndex}`;
                            contentHtml += `
                                <div class="shop-detail">
                                    <div class="flex items-center">
                                        <p class="font-bold text-gray-800">${detailItem.name.kor}</p>
                                        ${detailActionLinks}
                                    </div>
                                    <p class="text-xs text-gray-400">${detailItem.name.jpn} / ${detailItem.name.eng}</p>
                                    <p class="text-sm text-gray-500 italic mt-1">"${detailItem.description}"</p>
                                    <div class="mt-2 text-sm space-y-1">
                                        <p><span class="font-semibold text-amber-700">대표메뉴:</span> ${detailItem.signatureMenu} <span class="text-gray-500 text-xs">- ${detailItem.menuDescription}</span></p>
                                        <p><span class="font-semibold text-amber-700">1인당 예상 비용:</span> ${detailItem.avgCostPerPerson}</p>
                                        <p><span class="font-semibold text-amber-700">꿀팁:</span> ${detailItem.tip}</p>
                                    </div>
                                    <div class="mt-3 space-y-2">
                                        <div class="flex items-center gap-4">
                                            <label class="flex items-center cursor-pointer text-sm">
                                                <input type="checkbox" data-type="wantToGo" data-path="${dataPath}" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" ${detailItem.wantToGo ? 'checked' : ''}>
                                                <span class="ml-2">가고 싶어요</span>
                                            </label>
                                            <label class="flex items-center cursor-pointer text-sm">
                                                <input type="checkbox" data-type="visited" data-path="${dataPath}" class="h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-500" ${detailItem.visited ? 'checked' : ''}>
                                                <span class="ml-2">다녀왔어요</span>
                                            </label>
                                        </div>
                                        <textarea class="memo-textarea" data-type="memo" data-path="${dataPath}" placeholder="메모를 입력하세요...">${detailItem.memo || ''}</textarea>
                                    </div>
                                </div>
                            `;
                        } else {
                            contentHtml += `<div class="text-gray-600 text-sm">${detailItem.detail}</div>`;
                        }
                    });

                    html += `
                        <div class="card p-4 rounded-lg shadow-sm ${isHeatTip ? 'heat-tip' : ''}">
                            <div class="card-header flex justify-between items-center">
                                <div>
                                    <div class="flex items-center">
                                        <p class="font-semibold text-gray-800 flex items-center"><span class="mr-3 text-xl">${item.icon}</span> ${itemName}</p>
                                        ${actionLinks}
                                    </div>
                                    ${itemSubName}
                                </div>
                                <span class="text-amber-600 transform transition-transform duration-300">▼</span>
                            </div>
                            <div class="card-content pt-0">
                                <div class="mt-2 border-t pt-2">${contentHtml}</div>
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            });
            html += `</div></div>`;

            html += `<div class="lg:col-span-1">`;
            html += `<div class="sticky top-6">`;
            html += `<div class="bg-white p-4 rounded-lg shadow-md mb-6">
                        <h3 class="text-lg font-bold mb-3 text-amber-800 flex items-center">✔️ ${day}일차 핵심 미션</h3>
                        <ul class="space-y-2">`;
            dayData.checklist.forEach((item, index) => {
                html += `<li class="checklist-item flex items-center gap-2">
                            <label class="flex items-center cursor-pointer flex-grow">
                                <input type="checkbox" data-day="${day}" data-index="${index}" class="h-4 w-4 rounded border-gray-300 text-amber-600 focus:ring-amber-500" ${item.done ? 'checked' : ''}>
                                <input type="text" value="${item.text}" data-day="${day}" data-index="${index}" class="checklist-text-input ml-2 p-1 w-full text-gray-700">
                            </label>
                            <button data-day="${day}" data-index="${index}" class="delete-mission-btn text-red-400 hover:text-red-600 font-bold text-lg">×</button>
                         </li>`;
            });
            html += `</ul>
                     <div class="mt-4 flex gap-2">
                        <input type="text" id="new-mission-input-${day}" class="w-full border-gray-300 rounded-md shadow-sm focus:border-amber-500 focus:ring-amber-500 sm:text-sm" placeholder="새 미션 추가...">
                        <button data-day="${day}" class="add-mission-btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-1 px-3 rounded-md">추가</button>
                     </div>
                    </div>`;
            html += `<div class="bg-blue-50 p-4 rounded-lg shadow-md border-l-4 border-blue-400">
                        <h3 class="text-lg font-bold mb-2 text-blue-800 flex items-center">💡 ${day}일차 동선 하이라이트</h3>
                        <p class="text-sm text-blue-700">${dayData.route_highlight}</p>
                     </div>`;
            html += `</div></div>`;

            html += `</div>`;
            contentArea.innerHTML = html;
        }

        function renderCharts() {
            if (themeChart) themeChart.destroy();
            if (budgetChart) budgetChart.destroy();

            const themeCtx = document.getElementById('themeChart').getContext('2d');
            themeChart = new Chart(themeCtx, {
                type: 'bar',
                data: {
                    labels: ['1일차: 전통', '2일차: 서브컬처', '3일차: 쇼핑', '4일차: 시장'],
                    datasets: [{
                        label: '주요 활동',
                        data: [100, 100, 100, 100],
                        backgroundColor: ['#FBBF24', '#60A5FA', '#F472B6', '#34D399'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { display: false } }
                }
            });

            const budgetCtx = document.getElementById('budgetChart').getContext('2d');
            budgetChart = new Chart(budgetCtx, {
                type: 'doughnut',
                data: {
                    labels: ['가성비 맛집', '특별한 맛집', '디저트/간식'],
                    datasets: [{
                        data: [50, 25, 25],
                        backgroundColor: ['#34D399', '#F472B6', '#FBBF24'],
                        borderColor: '#FDFBF8',
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { callbacks: { label: (c) => `${c.label}: ${c.raw}%` } }
                    }
                }
            });
        }
        
        function saveData() {
            localStorage.setItem('tokyoTripPlanData', JSON.stringify(tripData));
        }

        function loadData() {
            const savedData = localStorage.getItem('tokyoTripPlanData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                // Merge saved user data into the default tripData structure
                Object.keys(parsedData).forEach(dayKey => {
                    if (tripData[dayKey] && parsedData[dayKey].sections) {
                        parsedData[dayKey].sections.forEach((section, sectionIndex) => {
                            section.items.forEach((item, itemIndex) => {
                                item.content.forEach((detailItem, detailIndex) => {
                                    if (detailItem.name && tripData[dayKey].sections[sectionIndex]?.items[itemIndex]?.content[detailIndex]) {
                                        const target = tripData[dayKey].sections[sectionIndex].items[itemIndex].content[detailIndex];
                                        target.wantToGo = detailItem.wantToGo || false;
                                        target.visited = detailItem.visited || false;
                                        target.memo = detailItem.memo || '';
                                    }
                                });
                            });
                        });
                        if (parsedData[dayKey].checklist) {
                           tripData[dayKey].checklist = parsedData[dayKey].checklist;
                        }
                    }
                });
            }
        }
        
        function applyFontSize(size) {
            document.documentElement.style.setProperty('--base-font-size', `${size}px`);
        }

        function updateFontSize(newSize) {
            localStorage.setItem('tokyoTripFontSize', newSize);
            applyFontSize(newSize);
        }

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const day = parseInt(button.dataset.day);
                navButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                renderDay(day);
            });
        });
        
        contentArea.addEventListener('click', function(e) {
            const copyButton = e.target.closest('.copy-button');
            if (copyButton) {
                e.stopPropagation();
                const textToCopy = copyButton.dataset.copyText;
                const originalIcon = copyButton.innerHTML;

                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);

                copyButton.innerHTML = '✅';
                copyButton.classList.add('copied');
                setTimeout(() => {
                    copyButton.innerHTML = originalIcon;
                    copyButton.classList.remove('copied');
                }, 1500);
                return;
            }

            const deleteBtn = e.target.closest('.delete-mission-btn');
            if (deleteBtn) {
                const day = deleteBtn.dataset.day;
                const index = parseInt(deleteBtn.dataset.index);
                tripData[day].checklist.splice(index, 1);
                saveData();
                renderDay(day);
                return;
            }

            const addBtn = e.target.closest('.add-mission-btn');
            if (addBtn) {
                const day = addBtn.dataset.day;
                const input = document.getElementById(`new-mission-input-${day}`);
                if (input && input.value.trim() !== '') {
                    tripData[day].checklist.push({ text: input.value.trim(), done: false });
                    saveData();
                    renderDay(day);
                }
                return;
            }
            
            const header = e.target.closest('.card-header');
            if (header && !e.target.closest('.map-link')) {
                const content = header.nextElementSibling;
                const arrow = header.querySelector('span.text-amber-600');
                content.classList.toggle('open');
                if (content.classList.contains('open')) {
                    content.style.paddingTop = '0.5rem';
                    arrow.style.transform = 'rotate(180deg)';
                } else {
                    content.style.paddingTop = '0';
                    arrow.style.transform = 'rotate(0deg)';
                }
            }
        });

        contentArea.addEventListener('input', function(e) {
            const target = e.target;
            if (target.matches('input[type="checkbox"][data-path]')) {
                const [day, sectionIndex, itemIndex, detailIndex] = target.dataset.path.split('-');
                const type = target.dataset.type;
                tripData[day].sections[sectionIndex].items[itemIndex].content[detailIndex][type] = target.checked;
                saveData();
            } else if (target.matches('textarea[data-path]')) {
                const [day, sectionIndex, itemIndex, detailIndex] = target.dataset.path.split('-');
                tripData[day].sections[sectionIndex].items[itemIndex].content[detailIndex].memo = target.value;
                saveData();
            } else if (target.matches('input[type="checkbox"][data-day]')) {
                 const day = target.dataset.day;
                 const index = target.dataset.index;
                 tripData[day].checklist[index].done = target.checked;
                 saveData();
            } else if (target.matches('.checklist-text-input')) {
                const day = target.dataset.day;
                const index = target.dataset.index;
                tripData[day].checklist[index].text = target.value;
                saveData();
            }
        });

        // Font size controller logic
        const increaseButton = document.getElementById('increase-font');
        const decreaseButton = document.getElementById('decrease-font');
        const resetButton = document.getElementById('reset-font');
        let currentFontSize = parseInt(localStorage.getItem('tokyoTripFontSize') || '16');
        
        applyFontSize(currentFontSize);

        increaseButton.addEventListener('click', () => {
            if (currentFontSize < 24) { // Max size
                currentFontSize += 1;
                updateFontSize(currentFontSize);
            }
        });

        decreaseButton.addEventListener('click', () => {
            if (currentFontSize > 12) { // Min size
                currentFontSize -= 1;
                updateFontSize(currentFontSize);
            }
        });
        
        resetButton.addEventListener('click', () => {
            currentFontSize = 16; // Default size
            updateFontSize(currentFontSize);
        });

        // Initialize
        loadData();
        renderDay(0);
    </script>
</body>
</html>
